models:
  - name: supplies
    description: Supply chain analytics mart, offering comprehensive metrics for each supply including performance tracking, inventory turnover, cost variance analysis, and supplier efficiency. One row per supply.
    columns:
      - name: supply_id
        description: The unique key of the supplies mart.
        data_tests:
          - not_null
          - unique
      - name: supply_name
        description: Name of the supply item.
      - name: product_id
        description: Product that uses this supply.
      - name: supply_cost
        description: Cost per unit of this supply.
      - name: is_perishable_supply
        description: Whether this supply is perishable.
      - name: orders_using_supply
        description: Number of distinct orders that used this supply.
      - name: total_usage_quantity
        description: Total quantity of this supply used across all orders.
      - name: revenue_generated
        description: Total revenue generated by products using this supply.
      - name: revenue_to_cost_ratio
        description: Ratio of revenue generated to supply cost incurred.
      - name: usage_rank
        description: Ranking by total usage quantity (1 = most used).
      - name: efficiency_rank
        description: Ranking by revenue-to-cost ratio (1 = most efficient).
      - name: inventory_turnover_ratio
        description: How many times the supply inventory turns over.
      - name: cost_variance_percentage
        description: Percentage variance between standard and actual cost.
      - name: usage_tier
        description: Usage classification (High/Medium/Low Usage).
      - name: efficiency_tier
        description: Efficiency classification (High/Medium/Low Efficiency).
      - name: risk_category
        description: Risk assessment based on usage patterns and cost variance.

semantic_models:
  - name: supplies
    description: |
      Supply chain analytics table. The grain of the table is one row per supply with comprehensive performance and efficiency metrics.
    model: ref('supplies')
    entities:
      - name: supply
        type: primary
        expr: supply_id
      - name: product
        type: foreign
        expr: product_id
    dimensions:
      - name: supply_id
        type: categorical
      - name: product_id
        type: categorical
      - name: supply_name
        type: categorical
      - name: is_perishable_supply
        type: categorical
      - name: usage_tier
        type: categorical
      - name: efficiency_tier
        type: categorical
      - name: risk_category
        type: categorical
      - name: supply_cost
        type: categorical
    measures:
      - name: supplies
        description: Count of unique supplies
        agg: count_distinct
        expr: supply_id
      - name: total_supply_cost
        description: Total supply cost across all supplies
        agg: sum
        expr: total_supply_cost_incurred
      - name: total_revenue_generated
        description: Total revenue generated by all supplies
        agg: sum
        expr: revenue_generated
      - name: avg_revenue_to_cost_ratio
        description: Average revenue-to-cost ratio
        agg: avg
        expr: revenue_to_cost_ratio
      - name: avg_inventory_turnover
        description: Average inventory turnover ratio
        agg: avg
        expr: inventory_turnover_ratio

metrics:
  - name: supply_cost
    description: Total supply cost
    label: Supply Cost
    type: simple
    type_params:
      measure: total_supply_cost
  - name: supply_revenue
    description: Total revenue generated by supplies
    label: Supply Revenue
    type: simple
    type_params:
      measure: total_revenue_generated
  - name: supply_count
    description: Count of supplies
    label: Supply Count
    type: simple
    type_params:
      measure: supplies
  - name: avg_supply_efficiency
    description: Average revenue-to-cost ratio across supplies
    label: Average Supply Efficiency
    type: simple
    type_params:
      measure: avg_revenue_to_cost_ratio

saved_queries:
  - name: supply_chain_metrics
    query_params:
      metrics:
        - supply_cost
        - supply_revenue
        - supply_count
        - avg_supply_efficiency
      group_by:
        - Entity('supply')
    exports:
      - name: supply_chain_metrics
        config:
          export_as: table
