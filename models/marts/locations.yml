models:
  - name: locations
    description: Location/store analytics mart, offering comprehensive performance metrics for each store including revenue comparisons, customer behavior patterns, and supply chain efficiency. One row per location.
    columns:
      - name: location_id
        description: The unique key of the locations mart.
        data_tests:
          - not_null
          - unique
      - name: location_name
        description: Store location name.
      - name: tax_rate
        description: Tax rate applied at this location.
      - name: opened_date
        description: Date when the location opened.
      - name: total_orders
        description: Total number of orders placed at this location.
      - name: unique_customers
        description: Number of unique customers who have ordered from this location.
      - name: total_revenue
        description: Total revenue generated by this location.
      - name: total_profit
        description: Total profit generated by this location.
      - name: avg_order_value
        description: Average order value at this location.
      - name: revenue_rank
        description: Ranking by total revenue (1 = highest revenue).
      - name: customer_retention_rate
        description: Percentage of customers who are returning customers.
      - name: performance_tier
        description: Performance classification based on revenue rank.
      - name: retention_tier
        description: Customer retention classification.

semantic_models:
  - name: locations
    description: |
      Location performance analytics table. The grain of the table is one row per location with comprehensive performance metrics.
    model: ref('locations')
    defaults:
      agg_time_dimension: opened_date
    entities:
      - name: location
        type: primary
        expr: location_id
    dimensions:
      - name: location_name
        type: categorical
      - name: performance_tier
        type: categorical
      - name: retention_tier
        type: categorical
      - name: opened_date
        expr: opened_date
        type: time
        type_params:
          time_granularity: day
      - name: tax_rate
        type: categorical
    measures:
      - name: locations
        description: Count of unique locations
        agg: count_distinct
        expr: location_id
      - name: total_revenue
        description: Total revenue across all locations
        agg: sum
      - name: total_profit
        description: Total profit across all locations
        agg: sum
      - name: total_orders
        description: Total orders across all locations
        agg: sum
      - name: avg_order_value
        description: Average order value across locations
        agg: avg
      - name: avg_customer_retention_rate
        description: Average customer retention rate
        agg: avg
        expr: customer_retention_rate
      - name: average_tax_rate
        description: Average tax rate.
        expr: tax_rate
        agg: average

metrics:
  - name: location_revenue
    description: Total location revenue
    label: Location Revenue
    type: simple
    type_params:
      measure: total_revenue
  - name: location_profit
    description: Total location profit
    label: Location Profit
    type: simple
    type_params:
      measure: total_profit
  - name: location_count
    description: Count of locations
    label: Location Count
    type: simple
    type_params:
      measure: locations
  - name: avg_location_order_value
    description: Average order value across locations
    label: Average Order Value
    type: simple
    type_params:
      measure: avg_order_value

saved_queries:
  - name: location_performance_metrics
    query_params:
      metrics:
        - location_revenue
        - location_profit
        - location_count
        - avg_location_order_value
      group_by:
        - Entity('location')
    exports:
      - name: location_performance_metrics
        config:
          export_as: table
