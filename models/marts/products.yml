models:
  - name: products
    description: Product performance analytics mart, offering comprehensive metrics for each product including revenue, profitability, popularity rankings, seasonal trends, and location-based performance. One row per product.
    columns:
      - name: product_id
        description: The unique key of the products mart.
        data_tests:
          - not_null
          - unique
      - name: product_name
        description: Product name.
      - name: product_type
        description: Product category (jaffle or beverage).
      - name: product_price
        description: Product selling price in dollars.
      - name: total_orders
        description: Total number of distinct orders containing this product.
      - name: total_quantity_sold
        description: Total quantity of this product sold across all orders.
      - name: total_revenue
        description: Total revenue generated by this product.
      - name: total_supply_cost
        description: Total supply cost for this product.
      - name: total_profit
        description: Total profit (revenue minus supply cost) for this product.
      - name: profit_margin_ratio
        description: Profit margin ratio (profit divided by supply cost).
      - name: revenue_rank
        description: Ranking by total revenue (1 = highest revenue).
      - name: popularity_rank
        description: Ranking by total quantity sold (1 = most popular).
      - name: profit_rank
        description: Ranking by total profit (1 = most profitable).
      - name: performance_tier
        description: Performance classification based on revenue rank.
      - name: seasonality_index
        description: Measure of seasonal variation (0 = no seasonality, 1 = highly seasonal).

semantic_models:
  - name: products
    description: |
      Product performance analytics table. The grain of the table is one row per product with comprehensive performance metrics.
    model: ref('products')
    entities:
      - name: product
        type: primary
        expr: product_id
    dimensions:
      - name: product_name
        type: categorical
      - name: product_type
        type: categorical
      - name: product_description
        type: categorical
      - name: is_food_item
        type: categorical
      - name: is_drink_item
        type: categorical
      - name: product_price
        type: categorical
      - name: performance_tier
        type: categorical
      - name: revenue_rank
        type: categorical
      - name: popularity_rank
        type: categorical
    measures:
      - name: products
        description: Count of unique products
        agg: count_distinct
        expr: product_id
      - name: total_revenue
        description: Total revenue across all products
        agg: sum
      - name: total_profit
        description: Total profit across all products
        agg: sum
      - name: total_quantity_sold
        description: Total quantity sold across all products
        agg: sum
      - name: avg_profit_margin
        description: Average profit margin ratio
        agg: avg
        expr: profit_margin_ratio

metrics:
  - name: product_revenue
    description: Total product revenue
    label: Product Revenue
    type: simple
    type_params:
      measure: total_revenue
  - name: product_profit
    description: Total product profit
    label: Product Profit
    type: simple
    type_params:
      measure: total_profit
  - name: product_count
    description: Count of products
    label: Product Count
    type: simple
    type_params:
      measure: products
  - name: avg_profit_margin
    description: Average profit margin across products
    label: Average Profit Margin
    type: simple
    type_params:
      measure: avg_profit_margin

saved_queries:
  - name: product_performance_metrics
    query_params:
      metrics:
        - product_revenue
        - product_profit
        - product_count
        - avg_profit_margin
      group_by:
        - Entity('product')
    exports:
      - name: product_performance_metrics
        config:
          export_as: table
